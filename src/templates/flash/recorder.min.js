var Wami=window.Wami||{};Wami.createID=function(){return"wid"+(""+1e10).replace(/[018]/g,function(a){return(a^Math.random()*16>>a/4).toString(16)})};Wami.nameCallback=function(cb,cleanup){Wami._callbacks=Wami._callbacks||{};var id=Wami.createID();Wami._callbacks[id]=function(){if(cleanup){Wami._callbacks[id]=null}cb.apply(null,arguments)};var named="Wami._callbacks['"+id+"']";return named};Wami.setup=function(options){if(Wami.startRecording){if(options.onReady){options.onReady()}return}Wami.swfobject=Wami.swfobject||swfobject;if(!Wami.swfobject){alert("Unable to find swfobject to help embed the SWF.")}var _options;setOptions(options);embedWamiSWF(_options.id,Wami.nameCallback(delegateWamiAPI));function supportsTransparency(){return navigator.platform.indexOf("Linux")==-1}function setOptions(options){_options={swfUrl:"Wami.swf",onReady:function(){Wami.hide()},onSecurity:checkSecurity,onError:function(error){alert(error)}};if(typeof options=="undefined"){alert("Need at least an element ID to place the Flash object.")}if(typeof options=="string"){_options.id=options}else{_options.id=options.id}if(options.swfUrl){_options.swfUrl=options.swfUrl}if(options.onReady){_options.onReady=options.onReady}if(options.onLoaded){_options.onLoaded=options.onLoaded}if(options.onSecurity){_options.onSecurity=options.onSecurity}if(options.onError){_options.onError=options.onError}var container=document.createElement("div");container.style.position="absolute";_options.cid=Wami.createID();container.setAttribute("id",_options.cid);var swfdiv=document.createElement("div");var id=Wami.createID();swfdiv.setAttribute("id",id);container.appendChild(swfdiv);document.getElementById(_options.id).appendChild(container);_options.id=id}function checkSecurity(){var settings=Wami.getSettings();if(settings.microphone.granted){_options.onReady()}else{Wami.showSecurity("privacy","Wami.show",Wami.nameCallback(_options.onSecurity),Wami.nameCallback(_options.onError))}}function embedWamiSWF(id,initfn){var flashVars={visible:false,loadedCallback:initfn};var params={allowScriptAccess:"always"};if(supportsTransparency()){params.wmode="transparent"}if(typeof console!=="undefined"){flashVars.console=true}var version="10.0.0";document.getElementById(id).innerHTML="WAMI requires Flash "+version+" or greater<br />https://get.adobe.com/flashplayer/";Wami.swfobject.embedSWF(_options.swfUrl,id,214,137,version,null,flashVars,params);Wami.swfobject.createCSS("#"+id,"outline:none")}function checkRemembered(finishedfn){var id=Wami.createID();var div=document.createElement("div");div.style.top="-999px";div.style.left="-999px";div.setAttribute("id",id);var body=document.getElementsByTagName("body").item(0);body.appendChild(div);var fn=Wami.nameCallback(function(){var swf=document.getElementById(id);Wami._remembered=swf.getSettings().microphone.granted;Wami.swfobject.removeSWF(id);eval(finishedfn+"()")});embedWamiSWF(id,fn)}function delegateWamiAPI(){var recorder=document.getElementById(_options.id);function delegate(name){Wami[name]=function(){return recorder[name].apply(recorder,arguments)}}delegate("startPlaying");delegate("stopPlaying");delegate("startRecording");delegate("stopRecording");delegate("startListening");delegate("stopListening");delegate("getRecordingLevel");delegate("getPlayingLevel");delegate("setSettings");Wami.getSettings=function(){var settings=recorder.getSettings();settings.microphone.remembered=Wami._remembered;return settings};Wami.showSecurity=function(panel,startfn,finishedfn,failfn){var container=document.getElementById(_options.cid);var augmentedfn=Wami.nameCallback(function(){checkRemembered(finishedfn);container.style.cssText="position: absolute;"});container.style.cssText="position: absolute; z-index: 99999";recorder.showSecurity(panel,startfn,augmentedfn,failfn)};Wami.show=function(){if(!supportsTransparency()){recorder.style.visibility="visible"}};Wami.hide=function(){if(!supportsTransparency()){recorder.style.visibility="hidden"}};Wami._remembered=recorder.getSettings().microphone.granted;if(_options.onLoaded){_options.onLoaded()}if(!_options.noSecurityCheck){checkSecurity()}}};